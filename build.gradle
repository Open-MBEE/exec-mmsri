buildscript {
    repositories {
        maven { url 'https://repo.spring.io/plugins-release' }
        gradlePluginPortal()
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath "org.jfrog.buildinfo:build-info-extractor-gradle:latest.release"
    }
}

plugins {
    id 'org.hidetake.swagger.generator' version '2.18.2'
    id 'org.springframework.boot' version '${springBootVersion}'
    id 'io.spring.dependency-management' version '1.0.9.RELEASE'
    id 'com.jfrog.artifactory' version '4.17.0'
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation (
            'org.openmbee.mms:authenticator:${mmsVersion}',
            'org.openmbee.mms:localuser:${mmsVersion}',
            'org.openmbee.mms:ldap:${mmsVersion}',
            'org.openmbee.mms:cameo:${mmsVersion}',
            'org.openmbee.mms:elastic:${mmsVersion}',
            'org.openmbee.mms:jupyter:${mmsVersion}',
            'org.openmbee.mms:permissions:${mmsVersion}',
            'org.openmbee.mms:webhooks:${mmsVersion}',
            'org.openmbee.mms:search:${mmsVersion}',
            'org.openmbee.mms:artifacts:${mmsVersion}',
            'org.springframework.boot:spring-boot-starter-web',
            'org.postgresql:postgresql:42.2.5',
            'org.springdoc:springdoc-openapi-ui:1.3.1',
            'org.springdoc:springdoc-openapi-security:1.3.1'
    )
    testImplementation(
            'org.springframework.boot:spring-boot-starter-test'
    )
    swaggerCodegen 'org.openapitools:openapi-generator-cli:4.3.0'
}

swaggerSources {
    python {
        inputFile = file('openapi/api-docs.yaml')
        code {
            language = 'python'
            configFile = file('openapi/python-config.json')
        }
    }
    java {
        inputFile = file('openapi/api-docs.yaml')
        code {
            language = 'java'
            configFile = file('openapi/java-config.json')
        }
    }
    doc {
        inputFile = file('openapi/api-docs.yaml')
        code {
            language = 'html2'
            configFile = file('openapi/doc-config.json')
        }
    }
}

//https://stackoverflow.com/questions/61197984/bootjar-mavenjar-artifact-wasnt-produced-by-this-build
configurations {
    [apiElements, runtimeElements].each {
        it.outgoing.artifacts.removeIf { it.buildDependencies.getDependencies(null).contains(jar) }
        it.outgoing.artifact(bootJar)
    }
}

artifactory {
    contextUrl = "${artifactory_contextUrl}"   //The base Artifactory URL if not overridden by the publisher/resolver
    resolve {
        repository {
            repoKey = 'libs-snapshot'
            username = "${artifactory_user}"
            password = "${artifactory_password}"
            maven = true

        }
    }
}